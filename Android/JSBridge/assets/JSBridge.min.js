(function(w,doc){if(w.JSBridge){return}var JSBRIDGE_URL_SCHEME="jsbridgeurlscheme";var JSBRIDGE_URL_MESSAGE="__JSB_URL_MESSAGE__";var JSBRIDGE_URL_PARAM="__JSB_PARAM_NONE__";var ua=navigator.userAgent;var isIOSDevice=/iP(hone|od|ad)/g.test(ua);var isAndroidDevice=/Android/g.test(ua);var sendMessageQueue=[];var receiveMessageQueue=[];var messageHandlers={};var responseCallbacks={};var uniqueId=1;var messagingIframe;function JSBridgeLog(){if(typeof console!="undefined"){console.log("JSBridge:JS: LOG: ",arguments)}}function JSBridgeLogException(e,m){if(typeof console!="undefined"){console.error("JSBridge:JS: EXCEPTION: ",arguments)}}function getIFrameSrc(param){return JSBRIDGE_URL_SCHEME+"://"+JSBRIDGE_URL_MESSAGE+"/"+((param)?(param):(JSBRIDGE_URL_PARAM))}function callObjCAPI(name,data){var methodDetails=name.split(".");var iframe=document.createElement("IFRAME");iframe.setAttribute("src",getIFrameSrc(methodDetails[0]+"&"+encodeURIComponent(methodDetails[1])+"&"+data));document.documentElement.appendChild(iframe);iframe.parentNode.removeChild(iframe);iframe=null;var ret=JSBridge.nativeReturnValue;JSBridge.nativeReturnValue=undefined;if(ret){return decodeURIComponent(ret)}}function triggerNativeCall(){if(isIOSDevice){messagingIframe.src=getIFrameSrc()}else{var apiName=((isAndroidDevice)?("AndroidAPI.NativeAPI"):("WebAppAPI.NativeAPI"));try{var api=eval(apiName);if(api){api(_fetchJSQueue())}}catch(e){}}}function doSend(message,responseCallback){if(responseCallback){var callbackId="cb_"+(uniqueId++)+"_"+new Date().getTime();responseCallbacks[callbackId]=responseCallback;message.callbackId=callbackId}sendMessageQueue.push(message);triggerNativeCall()}function dispatchMessageFromNative(messageJSON){setTimeout(function _timeoutDispatchMessageFromObjC(){var message=JSON.parse(messageJSON);var messageHandler;var responseCallback;if(message.responseId){responseCallback=responseCallbacks[message.responseId];if(!responseCallback){return}responseCallback(message.responseData);delete responseCallbacks[message.responseId]}else{if(message.callbackId){var callbackResponseId=message.callbackId;responseCallback=function(responseData){doSend({responseId:callbackResponseId,responseData:responseData})}}try{var handler=((message.eventName)?(messageHandlers[message.eventName]):(JSBridge.bridgeHandler));handler(message.data,responseCallback)}catch(e){JSBridgeLogException(e,"dispatchMessageFromNative")}}})}function init(bridgeHandler){if(JSBridge.bridgeHandler){JSBridgeLogException(e,"init")}JSBridge.bridgeHandler=bridgeHandler;var receivedMessages=receiveMessageQueue;receiveMessageQueue=null;for(var i=0;i<receivedMessages.length;i++){dispatchMessageFromNative(receivedMessages[i])}}function send(eventName,data,responseCallback){var dataToSend={};if(eventName){dataToSend.eventName=eventName}if(data){dataToSend.data=data}doSend(dataToSend,responseCallback)}function registerEvent(eventName,handler){messageHandlers[eventName]=handler}function deRegisterEvent(eventName,handler){if(messageHandlers[eventName]){delete messageHandlers[eventName]}}function callAPI(name,data,responseCallback){try{if(data){if(responseCallback){var cbID="cbID"+(+new Date);responseCallbacks[cbID]=responseCallback;data.callbackID=cbID}try{data=JSON.stringify(data)}catch(e){}}if(isIOSDevice){if(data){data=encodeURIComponent(data);name+=":"}return callObjCAPI(name,data)}var api=eval(name);if(api){if(data){return api(data)}return api()}else{JSBridgeLogException("Unsupported API:",name)}}catch(e){JSBridgeLogException(e,"Invalid API:"+name)}}function _fetchJSQueue(){try{var messageQueueString=JSON.stringify(sendMessageQueue);sendMessageQueue=[];return messageQueueString}catch(e){JSBridgeLogException(e,"_fetchJSQueue")}return[]}function _handleMessageFromNative(messageJSON){if(receiveMessageQueue){receiveMessageQueue.push(messageJSON)}else{dispatchMessageFromNative(messageJSON)}}function _invokeJSCallback(cbID,removeAfterExecute,config){if(cbID){var cb=responseCallbacks[cbID];if(cb){if(removeAfterExecute){delete (responseCallbacks[cbID])}var data=config;if(isAndroidDevice){try{data=JSON.parse(config)}catch(e){}}if(data.callbackID){delete (data.callbackID)}cb.call(null,data)}}}w.JSBridge={init:init,callAPI:callAPI,send:send,registerEvent:registerEvent,deRegisterEvent:deRegisterEvent,_fetchJSQueue:_fetchJSQueue,_handleMessageFromNative:_handleMessageFromNative,_invokeJSCallback:_invokeJSCallback};messagingIframe=doc.createElement("iframe");messagingIframe.style.display="none";triggerNativeCall();doc.documentElement.appendChild(messagingIframe);var readyEvent=doc.createEvent("Events");readyEvent.initEvent("JSBridgeReady");readyEvent.bridge=JSBridge;doc.dispatchEvent(readyEvent)})(window,document);